<!DOCTYPE html>
<html>
  <head>
    <title>Module Test Server</title>
    <base href="/">
    <meta charset="utf-8">
    <!-- <link rel="stylesheet" type="text/css" href="dist/<some_css_file>.css"/> -->
    <style>
      #container {
        box-sizing: border-box;
        padding-top: 5px;
        height: calc(100vh - 43px - 16px);
      }
      #testFunctionsContainer {
        padding: 5px;
      }
    </style>
  </head>
  <body spellcheck="false">
    <!-- load input element here -->
    <div id="treeSearch"></div>
    <div id="testFunctionsContainer">
      <input id="removeInput"></input>
      <button id="removeButton">Remove</button>
    </div>
    <div id="container">
      <!-- load tree element here -->
      <div id="tree"></div>
    </div>
  </body>
</html>
<!-- <script defer type="module" src="src/js/module.js"></script> -->
<script type="module">

  import treeator from '/src/js/module.js';
  import inputjs from '/node_modules/@joshadams/inputjs/src/js/module.js';

  let data = [];

  for (let i = 0; i < 10; i++) {
    data.push({DATA_DEPTH: 0, ITEM: "Montara FPSO", DESCRIPTION: "Facility", ICON_TYPE: 'folder'});
    data.push({DATA_DEPTH: 1, ITEM: "Cargo Oil", DESCRIPTION: "System", ICON_TYPE: 'folder'});
    data.push({DATA_DEPTH: 2, ITEM: "33-ZX-012 6C Cargo Oil Tank", DESCRIPTION: "Loop - Tank - 6C Cargo Oil Tank", ICON_TYPE: 'file'});
  }

  const treeOptions = {
    tree: {
      div: 'tree',
      data: data,
      renderer: null,
      columns: {
        displayNames: false,
        sourceNames: ["ITEM"],
        newNames: ["ITEM"],
        widths: [250],
        alignment: ["left"]
      },
      rows: {
        collapseIcon: null,
        expandIcon: null,
        rowTypeIcons: 'filesystem',
        renderer: null,
        onClick: null,
        onDblClick: null,
        onHover: null,
        onHoverOut: null
      },
      cells: {
        renderer: null
      }
    },
    search: {
      div: "treeSearch"
    }
  }

  const inputOptions = {
    div: 'treeSearch',
    renderer: null,
    onClick: null,
    onFocusOut: null,
    onHover: null,
    onKeyUp: function () {
      treeator.searchTable('inputjs-container__input', 'treeator-tree', 'tree', treeOptions)
    },
    icon: {
      innerHTML: null,
      renderer: null
    }
  };

  // test tree creation
  inputjs.init(inputOptions);
  treeator.init(treeOptions);

  // test append function
  let records = [{
    position: 1,
    data: {DATA_DEPTH: 1, ITEM: "Test 1", DESCRIPTION: "Test 1", ICON_TYPE: 'folder'}
  }, {
    position: 0,
    data: {DATA_DEPTH: 0, ITEM: "Test 2", DESCRIPTION: "Test 2", ICON_TYPE: 'folder'}
  }];

  treeator.appendTreeRecords(records);

  // assign onclick function to test buttons
  let removeInput = document.getElementById('removeInput');
  let removeButton = document.getElementById('removeButton');
  removeButton.onclick = function (event) {
    let removeIndex = removeInput.value;
    const record = [];
    if (removeIndex) {
      removeIndex = parseInt(removeIndex);
      record.push({
        position: removeIndex
      });
    }    
    treeator.removeTreeRecords(record);
  }
</script>
